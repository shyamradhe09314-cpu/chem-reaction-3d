<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chemical Reaction Demo</title>
  <style>
    body { margin: 0; background: black; color: white; font-family: Arial; }
    #info { position: absolute; top: 20px; left: 20px; font-size: 22px; font-weight: bold; }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="info">H₂ + O₂ → H₂O (Reaction Demo)</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(5, 5, 5);
    scene.add(light);

    // Helper function: Atom sphere
    function createAtom(color, x, y, z) {
      const geometry = new THREE.SphereGeometry(0.4, 32, 32);
      const material = new THREE.MeshPhongMaterial({ color: color });
      const sphere = new THREE.Mesh(geometry, material);
      sphere.position.set(x, y, z);
      scene.add(sphere);
      return sphere;
    }

    // Helper function: Bond (Cylinder)
    function createBond(atom1, atom2) {
      const material = new THREE.MeshPhongMaterial({ color: 0xaaaaaa });
      const geometry = new THREE.CylinderGeometry(0.1, 0.1, 1, 16);
      const bond = new THREE.Mesh(geometry, material);
      scene.add(bond);
      bond.atom1 = atom1;
      bond.atom2 = atom2;
      return bond;
    }

    // Create H2 + O2 molecules
    const H1 = createAtom(0xffffff, -3, 0, 0);
    const H2 = createAtom(0xffffff, -2, 0, 0);
    const O1 = createAtom(0xff0000, 2, 0, 0);
    const O2 = createAtom(0xff0000, 3, 0, 0);

    const bondH = createBond(H1, H2);
    const bondO = createBond(O1, O2);

    camera.position.z = 8;

    // Update bond positions
    function updateBond(bond) {
      const pos1 = bond.atom1.position;
      const pos2 = bond.atom2.position;
      const mid = new THREE.Vector3().addVectors(pos1, pos2).multiplyScalar(0.5);
      bond.position.copy(mid);

      bond.scale.set(1, pos1.distanceTo(pos2), 1);
      bond.lookAt(pos2);
      bond.rotateX(Math.PI / 2);
    }

    function animate() {
      requestAnimationFrame(animate);
      updateBond(bondH);
      updateBond(bondO);
      renderer.render(scene, camera);
    }
    animate();

    // Reaction animation after 3 sec
    setTimeout(() => {
      // Move hydrogens near oxygen to form H2O
      gsap.to(H1.position, { x: 2, y: 0.8, duration: 2 });
      gsap.to(H2.position, { x: 2, y: -0.8, duration: 2 });
      gsap.to(O1.position, { x: 2, y: 0, duration: 2 });
      gsap.to(O2.position, { x: 100, duration: 2 }); // move away (extra O)

      // Remove old bonds after reaction
      setTimeout(() => {
        scene.remove(bondH);
        scene.remove(bondO);

        // New H2O bonds
        const bond1 = createBond(O1, H1);
        const bond2 = createBond(O1, H2);

        function animateReaction() {
          requestAnimationFrame(animateReaction);
          updateBond(bond1);
          updateBond(bond2);
          renderer.render(scene, camera);
        }
        animateReaction();

      }, 2500);
    }, 3000);
  </script>
</body>
</html>
